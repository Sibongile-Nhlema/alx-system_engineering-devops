#!/usr/bin/env bash
# Update and install Nginx
echo "Updating packages..."
sudo apt-get update -y -qq
echo "Installing Nginx..."
sudo apt-get install nginx -y

# Start Nginx service
echo "Starting Nginx service..."
sudo service nginx start

# Allow Nginx through the firewall
echo "Allowing Nginx through the firewall..."
sudo ufw allow 'Nginx HTTP'

# Create a default index.html file with "Hello World"
echo "Creating default index.html file..."
echo "Hello World!" | sudo tee /var/www/html/index.html

# Create a custom 404 page with the required string
echo "Creating custom 404 page..."
echo "Ceci n'est pas une page" | sudo tee /var/www/html/404.html

# Configure Nginx to use the custom 404 page
sudo sed -i 's/#error_page 404 \/404.html;/error_page 404 \/404.html;/' /etc/nginx/sites-available/default
sudo sed -i 's/#location = \/404.html {/location = \/404.html {/' /etc/nginx/sites-available/default
sudo sed -i 's/#root \/var\/www\/html;/root \/var\/www\/html;/' /etc/nginx/sites-available/default

# Restart Nginx (alternative to systemctl)
echo "Restarting Nginx..."
sudo service nginx restart

echo "Nginx setup completed successfully."

